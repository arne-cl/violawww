# Web Archive Integration

## Что было реализовано

Добавлена интеграция с Internet Archive (Wayback Machine) для автоматического перенаправления на архивные версии сайтов, когда домен не существует.

## Как это работает

1. **Автоматическое определение**: Когда ViolaWWW пытается загрузить страницу и получает DNS-ошибку (домен не найден), браузер автоматически проверяет, есть ли архивная копия в Web Archive.

2. **CDX API для самой ранней версии**: Используется [CDX Search API](https://web.archive.org/cdx/search/cdx) от Internet Archive для поиска **САМОГО РАННЕГО** снимка:
   ```
   GET /cdx/search/cdx?url=http://example.com&limit=1&sort=ascending HTTP/1.1
   Host: web.archive.org
   ```
   - Параметр `sort=ascending` гарантирует самый первый архивный снимок
   - Использует текстовый формат (не JSON) - проще парсить
   - Поддерживает chunked encoding

3. **Пример**: Для [hackzone.ru CDX вернёт снимок от 1997-03-27](https://web.archive.org/cdx/search/cdx?url=www.hackzone.ru&output=json&limit=1&sort=ascending), а не более поздний от 2022 года!

4. **Прозрачное перенаправление**: Если снимок найден, ViolaWWW автоматически перенаправляет на URL вида:
   ```
   https://web.archive.org/web/TIMESTAMP/ORIGINAL_URL
   ```

## Примеры использования

### Запустить тесты
```bash
# Запустить все тесты (включая Web Archive интеграцию)
make test
```

### Протестировать с реальным сайтом
```bash
# Откроет архивную версию hackzone.ru от 1997 года (DNS не работает)
./src/vw/vw http://www.hackzone.ru/
```

## Технические детали

### Новые файлы
- `src/libWWW/Library/Implementation/HTWayback.h` - API интерфейс
- `src/libWWW/Library/Implementation/HTWayback.c` - Реализация интеграции с Web Archive  
- `test/test_wayback.c` - Unit-тесты для проверки функциональности

### Модифицированные файлы
- `src/libWWW/Library/Implementation/HTTP.c` - Добавлены таймауты и вызов Wayback при DNS-ошибке
- `src/libWWW/Library/Implementation/HTTPS.c` - Добавлены таймауты и вызов Wayback при DNS-ошибке
- `Makefile` - Добавлен HTWayback.c в LIBWWW_SRCS и target `test`

### API функция
```c
char* HTWaybackCheck(const char* url);
```
- Принимает URL сайта
- Возвращает Wayback URL если найден, иначе NULL
- Выделяет память динамически (требует free)

### Таймауты
- **Wayback API**: 5 секунд на запрос к archive.org
- **HTTP/HTTPS соединения**: 30 секунд на чтение/запись
- При превышении таймаута возвращается ошибка соединения

## Преимущества

✅ **Автоматическая работа** - не требует вмешательства пользователя  
✅ **Исторические снимки** - доступ к самым ранним версиям сайтов  
✅ **Прозрачность** - работает как обычная загрузка страницы  
✅ **Отказоустойчивость** - при недоступности API просто возвращает ошибку  

## Ограничения

- Работает только для HTTP/HTTPS протоколов
- Требует доступ к archive.org (проверяет через gethostbyname)
- Таймаут 5 секунд на запрос
- Не кэширует результаты (каждый раз делает новый запрос)

## Будущие улучшения (опционально)

- [ ] Кэширование результатов Wayback API
- [ ] Настройка предпочтительной даты снимка (ранняя/поздняя/конкретная)
- [ ] UI для выбора между разными снимками сайта
- [ ] Локальное хранилище известных архивных URL

